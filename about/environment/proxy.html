<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>代理与镜像(mirror)设置 | Leo Nicatot</title> <meta name="author" content="Leo Nicatot"> <meta name="description" content="# A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/favicon.ico"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://leonicatot.github.io/about/environment/proxy"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/">Leo Nicatot</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">首页</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">代理与镜像(mirror)设置</h1> <p class="post-description"></p> </header> <article> <h4 id="目录">目录</h4> <ol> <li><a href="#%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">注意事项</a></li> <li> <a href="#ubuntu">Ubuntu</a> <ol> <li><a href="#apt">apt</a></li> <li><a href="#%E9%80%9A%E8%BF%87%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86">通过环境变量设置代理</a></li> <li><a href="#%E5%B8%B8%E8%A7%81%E8%BD%AF%E4%BB%B6%E7%9A%84%E4%BB%A3%E7%90%86%E9%85%8D%E7%BD%AE">常见软件的代理配置</a></li> </ol> </li> <li><a href="#wsl2">WSL2</a></li> <li> <a href="#docker">docker</a> <ol> <li><a href="#docker-daemon">docker daemon</a></li> <li><a href="#docker-client">docker client</a></li> </ol> </li> </ol> <p><br><br></p> <h4 id="注意事项">注意事项</h4> <ul> <li>普通用户和 <code class="language-plaintext highlighter-rouge">root</code> 用户的环境变量是分开的。如果在普通用户下设置了代理（例如通过 <code class="language-plaintext highlighter-rouge">http_proxy</code> 或 <code class="language-plaintext highlighter-rouge">https_proxy</code> 环境变量），这些设置不会自动应用到 <code class="language-plaintext highlighter-rouge">sudo</code> 环境中。解决方法有： <ul> <li>显式地将代理设置传递给 <code class="language-plaintext highlighter-rouge">sudo</code> 环境：<code class="language-plaintext highlighter-rouge">sudo http_proxy=http://your-proxy:port https_proxy=http://your-proxy:port ...</code> </li> <li>或者使用 <code class="language-plaintext highlighter-rouge">-E</code> 参数保留当前用户的环境变量：<code class="language-plaintext highlighter-rouge">sudo -E ...</code> </li> </ul> </li> </ul> <p><br></p> <h4 id="ubuntu">Ubuntu</h4> <h5 id="apt">apt</h5> <p>先运行<code class="language-plaintext highlighter-rouge">apt update</code>，成功的话就可以直接用了。否则，</p> <ul> <li>把apt的<code class="language-plaintext highlighter-rouge">sources.list</code>换成国内镜像源（以Ubuntu 22.04 LTS为例） <ul> <li> <p>先备份一份旧的<code class="language-plaintext highlighter-rouge">sources.list</code></p> </li> <li> <p>然后执行下面的<code class="language-plaintext highlighter-rouge">change-source.sh</code>（这里选用<a href="http://mirror.nju.edu.cn/" rel="external nofollow noopener" target="_blank">NJU的镜像源</a>）：</p> <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>  <span class="nb">echo</span> <span class="s2">"deb http://mirror.nju.edu.cn/ubuntu/ jammy main restricted universe multiverse"</span>                <span class="o">&gt;</span> /etc/apt/sources.list 
  <span class="nb">echo</span> <span class="s2">"deb-src http://mirror.nju.edu.cn/ubuntu/ jammy main restricted universe multiverse"</span>           <span class="o">&gt;&gt;</span> /etc/apt/sources.list 
  <span class="nb">echo</span> <span class="s2">"deb http://mirror.nju.edu.cn/ubuntu/ jammy-security main restricted universe multiverse"</span>      <span class="o">&gt;&gt;</span> /etc/apt/sources.list 
  <span class="nb">echo</span> <span class="s2">"deb-src http://mirror.nju.edu.cn/ubuntu/ jammy-security main restricted universe multiverse"</span>  <span class="o">&gt;&gt;</span> /etc/apt/sources.list 
  <span class="nb">echo</span> <span class="s2">"deb http://mirror.nju.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse"</span>       <span class="o">&gt;&gt;</span> /etc/apt/sources.list 
  <span class="nb">echo</span> <span class="s2">"deb-src http://mirror.nju.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse"</span>   <span class="o">&gt;&gt;</span> /etc/apt/sources.list 
  <span class="nb">echo</span> <span class="s2">"deb http://mirror.nju.edu.cn/ubuntu/ jammy-proposed main restricted universe multiverse"</span>      <span class="o">&gt;&gt;</span> /etc/apt/sources.list 
  <span class="nb">echo</span> <span class="s2">"deb-src http://mirror.nju.edu.cn/ubuntu/ jammy-proposed main restricted universe multiverse"</span>  <span class="o">&gt;&gt;</span> /etc/apt/sources.list 
  <span class="nb">echo</span> <span class="s2">"deb http://mirror.nju.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse"</span>     <span class="o">&gt;&gt;</span> /etc/apt/sources.list 
  <span class="nb">echo</span> <span class="s2">"deb-src http://mirror.nju.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse"</span> <span class="o">&gt;&gt;</span> /etc/apt/sources.list 
</code></pre></div> </div> <p>如果是其它版本的Ubuntu，可以参照<a href="https://mirror.nju.edu.cn/mirrorz-help/ubuntu/?mirror=NJU" rel="external nofollow noopener" target="_blank">这里</a>。</p> </li> </ul> </li> <li>使用代理：参见<a href="#%E9%80%9A%E8%BF%87%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E8%AE%BE%E7%BD%AE%E4%BB%A3%E7%90%86">通过环境变量设置代理</a> </li> </ul> <h5 id="通过环境变量设置代理">通过环境变量设置代理</h5> <ul> <li>在当前shell中设置代理： <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">http_proxy</span><span class="o">=</span>http://proxy-server:port
<span class="nb">export </span><span class="nv">https_proxy</span><span class="o">=</span>http://proxy-server:port
</code></pre></div> </div> <ul> <li>清除当前shell中的代理： <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="nb">unset </span>http_proxy
<span class="nb">unset </span>https_proxy
</code></pre></div> </div> </li> </ul> </li> <li>为当前用户设置永久代理：把<code class="language-plaintext highlighter-rouge">export</code>放到<code class="language-plaintext highlighter-rouge">~/.bashrc</code>中 <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"export http_proxy=http://proxy-server:port"</span> <span class="o">&gt;&gt;</span> ~/.bashrc
<span class="nb">echo</span> <span class="s2">"export https_proxy=http://proxy-server:port"</span> <span class="o">&gt;&gt;</span> ~/.bashrc
<span class="nb">source</span> ~/.bashrc
</code></pre></div> </div> </li> <li>为所有用户设置永久代理：修改<code class="language-plaintext highlighter-rouge">/etc/environment</code><br><code class="language-plaintext highlighter-rouge">/etc/environment</code> 是一个系统级的配置文件，所有用户和进程都会继承该文件中定义的环境变量。修改 <code class="language-plaintext highlighter-rouge">/etc/environment</code> 后，代理设置不会立即生效。你需要重新登录系统或手动执行 <code class="language-plaintext highlighter-rouge">source /etc/environment</code> 命令来使更改生效。 <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="nv">http_proxy</span><span class="o">=</span>http://proxy-server:port
<span class="nv">https_proxy</span><span class="o">=</span>http://proxy-server:port
<span class="nv">ftp_proxy</span><span class="o">=</span>http://proxy-server:port
<span class="nv">no_proxy</span><span class="o">=</span><span class="s2">"localhost,127.0.0.1"</span>
</code></pre></div> </div> </li> </ul> <p><br></p> <h5 id="常见软件的代理配置">常见软件的代理配置</h5> <p>有些软件可能不走环境变量的代理，或者需要单独走代理，此时需要为其单独配置代理。</p> <ul> <li> <p>apt：在<code class="language-plaintext highlighter-rouge">/etc/apt/apt.conf.d/95proxies</code>中添加以下内容</p> <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>Acquire::http::Proxy <span class="s2">"http://proxy-server:port"</span><span class="p">;</span>
Acquire::https::Proxy <span class="s2">"http://proxy-server:port"</span><span class="p">;</span>
</code></pre></div> </div> </li> <li> <p>Git：使用以下命令</p> <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>git config <span class="nt">--global</span> http.proxy http://proxy-server:port
git config <span class="nt">--global</span> https.proxy http://proxy-server:port
</code></pre></div> </div> <p>或者修改配置文件：</p> <ul> <li>全局配置文件：<code class="language-plaintext highlighter-rouge">~/.gitconfig</code> </li> <li>当前仓库配置文件：<code class="language-plaintext highlighter-rouge">.git/config</code> </li> </ul> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>[http]
       proxy = http://127.0.0.1:7890
</code></pre></div> </div> </li> <li>wget：通过<code class="language-plaintext highlighter-rouge">~/.wgetrc</code>配置 <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="nb">echo</span> <span class="s2">"use_proxy=yes"</span> <span class="o">&gt;&gt;</span> ~/.wgetrc
<span class="nb">echo</span> <span class="s2">"http_proxy=http://proxy-server:port"</span> <span class="o">&gt;&gt;</span> ~/.wgetrc
<span class="nb">echo</span> <span class="s2">"https_proxy=http://proxy-server:port"</span> <span class="o">&gt;&gt;</span> ~/.wgetrc
</code></pre></div> </div> </li> <li>curl：在命令中使用<code class="language-plaintext highlighter-rouge">curl -x http://proxy-server:port http://example.com</code> </li> </ul> <p><br></p> <h4 id="wsl2">WSL2</h4> <p>WSL2中，如果是NAT模式，则无法使用Windows上配置的代理，而且此时Windows主机不是通过127.0.0.1访问。</p> <ul> <li>首先我们需要获取Windows的IP： <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>ip route show | <span class="nb">grep</span> <span class="nt">-i</span> default | <span class="nb">awk</span> <span class="s1">'{ print $3}'</span>
</code></pre></div> </div> </li> <li>用Windows的IP设置代理： <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="nb">export </span><span class="nv">http_proxy</span><span class="o">=</span>http://&lt;windows_ip&gt;:&lt;proxy_port&gt;
<span class="nb">export </span><span class="nv">https_proxy</span><span class="o">=</span>http://&lt;windows_ip&gt;:&lt;proxy_port&gt;
</code></pre></div> </div> </li> </ul> <p><br></p> <h4 id="docker">docker</h4> <h5 id="docker-daemon">docker daemon</h5> <p>Daemon的代理配置见<a href="https://docs.docker.com/engine/daemon/proxy/#daemon-configuration" rel="external nofollow noopener" target="_blank">Daemon proxy configuration</a>。官方提供了两种方法，这里仅介绍其中的一种方法：</p> <ul> <li> <p>在<code class="language-plaintext highlighter-rouge">/etc/docker/daemon.json</code>中设置</p> <div class="language-json highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"proxies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"http-proxy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://proxy.example.com:3128"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"https-proxy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://proxy.example.com:3129"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"no-proxy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*.test.example.com,.example.org,127.0.0.0/8"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div> </div> <ul> <li>重启docker daemon：<code class="language-plaintext highlighter-rouge">sudo systemctl restart docker</code> </li> </ul> </li> </ul> <h5 id="docker-client">docker client</h5> <p>docker CLI的代理配置见<a href="https://docs.docker.com/engine/cli/proxy/" rel="external nofollow noopener" target="_blank">Use a proxy server with the Docker CLI</a>。在<code class="language-plaintext highlighter-rouge">~/.docker/config.json</code>添加以下内容：</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
 </span><span class="nl">"proxies"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
   </span><span class="nl">"default"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
     </span><span class="nl">"httpProxy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://proxy.example.com:3128"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"httpsProxy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://proxy.example.com:3129"</span><span class="p">,</span><span class="w">
     </span><span class="nl">"noProxy"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*.test.example.com,.example.org,127.0.0.0/8"</span><span class="w">
   </span><span class="p">}</span><span class="w">
 </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2025 Leo Nicatot. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.8/dist/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="https://unpkg.com/bootstrap-table@1.21.4/dist/bootstrap-table.min.js"></script> <script src="/assets/js/no_defer.js"></script> <script defer src="/assets/js/common.js"></script> <script defer src="/assets/js/copy_code.js" type="text/javascript"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>